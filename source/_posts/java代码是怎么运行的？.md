## java代码是怎么运行的？ ##

### java代码的运行需要什么？ ###

	必须要有jre(java运行时环境)

### jre里面有什么？ ###
	java虚拟机
	java核心类库

### jdk是什么？ ###

	java开发工具包
	JDK里面也包含了jre
	此外还有一系列开发和诊断工具

### Java虚拟机 ###
#### java为什么要在虚拟机中运行？ ####
	Java作为高级程序语言，愈发复杂，抽象程度高，因为无法在硬件上运行。
	这就需要设计一个面向Java语言特性的虚拟机，并通过编译器将Java程序转换为该虚拟机所能识别的指令序列，也就是Java字节码
为什么要叫Java字节码（因为指令的操作码opcode被固定为一个字节）

##### 虚拟机的优点 #####
	 跨平台：一次编译到处执行
	 提供托管环境：JVM能代替程序员去做一些复杂且容易出错的工作
	 峰值性能更佳：JVM进行预热后，针对热点方法由于大量优化，且能够在运行中动态获取方法执行的情况等信息，从而能进一步优化，提高峰值性能
##### Java虚拟机的实现方式 #####
	可以由硬件实现：Java Proccessor（Java虚拟机在硬件上的实现），当前有十多种具体实现的Jvm
	最常见的是在各个平台上提供软件实现
##### Java虚拟机采用软件实现的好处 #####
	能够实现 一次编写，到处运行，因为程序一旦转为Java字节码，就可以在不通过平台的虚拟机实现里执行
##### 采用JVM作为托管环境的好处是什么 #####
	1、这个托管环境能够代替我们处理一些代码中冗长而且容易出错的部分
	2、自动内存管理
	3、垃圾回收
	4、数组越界、动态类型、安全权限等动态检测
##### Java虚拟机如何运行Java字节码 #####
标准JDK中的HotSpot是如何运行Java字节码的呢？
需要从两个角度考虑
##### 一、虚拟机角度 #####

     1、首先会将Java代码编译成的class文件加载到JVM
     2、加载后的Java类会存放到方法区中
     3、实际运行时，JVM会执行方法区内的代码
     4、运行时，每当调用进入一个Java方法，JVM会在当前线程的Java方法栈中生成一个栈帧
     5、退出执行的Java方法时，无论是不是正常返回，JVM都会弹出并舍弃掉当前线程的当前栈帧

栈帧是什么？

	1、用于存放局部变量、字节码的操作数
	2、栈帧的大小是提前计算好的
	3、JVM不要求栈帧在内存空间连续分布

JVM中内存组成部分有哪些？线程共享的是哪些部分？线程私有的是哪些部分？

	线程共享：
     方法区：存放加载后的Java类
     堆：创建的对象实例
	线程私有：
     Java方法栈：面向Java方法
     本地方法栈：面向C++写的native方法
     PC寄存器：存放各个线程执行位置

##### 二、底层硬件角度 #####
     1、Java字节码无法直接执行
     2、JVM需要将字节码翻译成机器码
	JVM（如HotSpot）如何将字节码翻译成机器码？
	两种方法：
     解释执行-逐条将字节码翻译成机器码执行；
     即时编译（Just_In-Time compilation, JIT）-将一个方法中的字节码都编译成机器码后在执行

HotSpot是如何采用这两种方法去执行Java代码呢？

	1、默认采用混合模式
	2、综合了两者的优点
	3、会先解释执行字节码
	4、之后将其中反复执行的热点代码，以方法为单位进行即时编译

即时编译是以什么为单位进行优化的？

	以方法为单位
##### Java虚拟机的效率如何 #####
Java虚拟机的效率如何？
HotSpot采用多种技术来提升启动性能和峰值性能
即时编译是重要技术之一
即时编译建立在二八定律之上，也就是20%的代码占据了80%的计算资源

为什么Java不和C++一样直接编译成机器码呢？
理论上Java的性能可以比C++更高
与静态编译相比，即时编译拥有程序的运行时信息，并能以此进行相应的优化
借助这些信息系，可以规避虚方法调用的开销，从而比静态编译的C++程序的性能更高

HotSpot内置了哪几种即时编译器？分别有什么作用和特点？
C1 ：Client编译器，优化手段简单，编译时间短，适合对启动性能有要求的客户端程序
C2 ： Server编译器，适合对峰值性能有要求的服务端程序，优化手段复杂，编译时间长，生成的代码执行效率高
Graal：实验性即时编译器

HotSpot如何采用这些即时编译器进行编译工作？

    HotSpot默认采用分层编译(从Java7开始)
    热点方法会先用C1编译
    然后热点方法中的热点，进一步用C2编译

HotSpot中编译线程是什么?

    为了不干扰应用的执行，即时编译会在额外的编译线程中进行。
    HotSpot会根据CPU数量设置编译线程的数目
    并且1:2的比例分配给C1和C2编译器

资源充足时，即时编译会替换解释执行？

	资源充足时，即时编译会替换解释执行
	在计算资源充足的情况下，字节码的解释执行和即时编译可同时进行。
	即时编译完成后的机器码会在 下次调用该方法时启用，以替换原本的解释执行。

原文链接：
https://blog.csdn.net/feather_wch/article/details/82320200
